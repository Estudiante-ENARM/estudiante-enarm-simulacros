<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Panel administrador - Estudiante ENARM</title>

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-B43LFZV7MR"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-B43LFZV7MR');
  </script>

  <!-- Meta Pixel -->
  <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    try{ fbq('init', '1146031771035535'); fbq('track', 'PageView'); } catch(e){ console.warn('fbq init failed', e); }
  </script>
  <noscript>
    <img height="1" width="1" style="display:none"
      src="https://www.facebook.com/tr?id=1146031771035535&ev=PageView&noscript=1"/>
  </noscript>

  <link rel="stylesheet" href="style.css" />
</head>

<body>
<div class="app">

  <!-- =========================================
       SIDEBAR IZQUIERDA: SECCIONES + ADMIN NAV
       ========================================= -->
  <aside class="sidebar left-sidebar">
    <div class="brand">
      <img src="./logo.png" class="logo" alt="Logo">
      <div class="brand-text">Estudiante ENARM</div>
    </div>

    <div class="sidebar-block">
      <h4 class="sidebar-title">Secciones</h4>
      <div id="sectionsList" class="sections">
        <!-- Secciones dinámicas -->
      </div>
      <button id="btnNewSection" class="btn full-width small-btn hidden">
        + Nueva sección
      </button>
    </div>

    <div id="adminNav" class="sidebar-block hidden">
      <h4 class="sidebar-title">Administrador</h4>
      <button class="btn full-width nav-btn" data-view="exams">
        Exámenes
      </button>
      <button class="btn full-width nav-btn" data-view="users">
        Usuarios
      </button>
    </div>

    <div class="sidebar-actions">
      <div id="mainCountdown" class="countdown"></div>

      <div class="socials">
        <a id="link-instagram" target="_blank" rel="noopener noreferrer">
          <img src="./instagram.png" alt="Instagram">
        </a>
        <a id="link-whatsapp" target="_blank" rel="noopener noreferrer">
          <img src="./whatsapp.png" alt="WhatsApp">
        </a>
        <a id="link-telegram" target="_blank" rel="noopener noreferrer">
          <img src="./telegram.png" alt="Telegram">
        </a>
        <a id="link-tiktok" target="_blank" rel="noopener noreferrer">
          <img src="./tiktok.png" alt="TikTok">
        </a>
      </div>
    </div>
  </aside>

  <!-- =========================================
       MAIN
       ========================================= -->
  <main class="main">

    <!-- TOPBAR -->
    <header class="topbar">
      <div class="top-left">
        <span class="app-title">Panel administrador</span>
      </div>
      <div class="top-right">
        <span id="userInfo" class="user-info"></span>
        <div id="authButtons" class="auth-buttons"></div>
      </div>
    </header>

    <!-- PANTALLAS PRINCIPALES -->
    <section id="screenLogin" class="screen">
      <div class="card centered">
        <h2>Acceso</h2>
        <p class="small muted">
          Inicia sesión con tu cuenta de administrador de Firebase.
        </p>
        <input id="inputEmail" type="email" placeholder="Correo electrónico" />
        <input id="inputPassword" type="password" placeholder="Contraseña" />
        <div class="row" style="margin-top:12px;">
          <button id="btnLogin" class="btn primary">Entrar</button>
          <button id="btnCancel" class="btn">Cancelar</button>
        </div>
        <div id="loginMessage" class="small muted" style="margin-top:8px;"></div>
      </div>
    </section>

    <!-- LISTA DE EXÁMENES DE LA SECCIÓN -->
    <section id="screenExams" class="screen hidden">
      <div class="screen-header">
        <div>
          <h2 id="currentSectionTitle">Exámenes</h2>
          <p class="small muted">Selecciona una sección en la barra izquierda.</p>
        </div>
        <div>
          <button id="btnNewExam" class="btn primary">
            + Nuevo examen
          </button>
        </div>
      </div>

      <div id="examsList" class="examsList"></div>
    </section>

    <!-- EDITOR DE UN EXAMEN (CASOS + PREGUNTAS) -->
    <section id="screenExamEditor" class="screen hidden">
      <div class="screen-header">
        <button id="btnBackToExams" class="btn">&larr; Volver a exámenes</button>
        <div>
          <h2 id="examEditorTitle">Editar examen</h2>
          <p class="small muted">Casos clínicos y preguntas en la misma pantalla.</p>
        </div>
      </div>

      <!-- META DEL EXAMEN -->
      <div id="examMeta" class="card">
        <label>
          Título del examen
          <input id="examTitleInput" type="text" />
        </label>

        <label>
          Descripción
          <input id="examDescInput" type="text" />
        </label>

        <div class="meta-row">
          <span>Total de preguntas:
            <strong id="examQuestionCount">0</strong>
          </span>
          <span>Tiempo estimado:
            <strong id="examDurationLabel">0 min</strong>
            <span class="small muted">(75 s por pregunta)</span>
          </span>
        </div>

        <div class="row" style="margin-top:10px;">
          <button id="btnSaveExamMeta" class="btn primary">
            Guardar examen
          </button>
          <button id="btnDeleteExam" class="btn danger">
            Eliminar examen
          </button>
        </div>
      </div>

      <!-- LISTA DE CASOS CLÍNICOS + PREGUNTAS -->
      <div id="casosList"></div>

      <!-- NUEVO CASO CLÍNICO -->
      <div class="card">
        <h3>Nuevo caso clínico</h3>
        <label>
          Título del caso
          <input id="newCasoTitulo" type="text" />
        </label>
        <label>
          Texto / descripción del caso
          <textarea id="newCasoTexto" rows="3"></textarea>
        </label>
        <div class="row" style="margin-top:10px;">
          <button id="btnAddCaso" class="btn primary">Agregar caso clínico</button>
        </div>
      </div>
    </section>

    <!-- USUARIOS -->
    <section id="screenUsers" class="screen hidden">
      <div class="screen-header">
        <div>
          <h2>Usuarios</h2>
          <p class="small muted">
            Usuarios de la colección <code>users</code> (Firestore).
          </p>
        </div>
        <div>
          <button id="btnNewUser" class="btn primary">
            + Nuevo usuario
          </button>
        </div>
      </div>

      <div id="usersList"></div>

      <div id="userForm" class="card hidden">
        <h3 id="userFormTitle">Nuevo usuario</h3>
        <p class="small muted">
          Importante: este formulario solo crea / actualiza el documento en
          <code>users/{uid}</code>.  
          La cuenta de autenticación (email/contraseña) se crea en
          <strong>Firebase Authentication</strong>.
        </p>

        <label>
          UID (igual al UID de Authentication)
          <input id="userUidInput" type="text" />
        </label>

        <label>
          Nombre
          <input id="userNameInput" type="text" />
        </label>

        <label>
          Email
          <input id="userEmailInput" type="email" />
        </label>

        <label>
          Rol
          <select id="userRoleInput">
            <option value="user">Usuario</option>
            <option value="admin">Admin</option>
          </select>
        </label>

        <label>
          Estado
          <select id="userEstadoInput">
            <option value="habilitado">Habilitado</option>
            <option value="inhabilitado">Inhabilitado</option>
          </select>
        </label>

        <label>
          Fecha límite de acceso
          <input id="userExpInput" type="date" />
        </label>

        <div class="row" style="margin-top:10px;">
          <button id="btnSaveUser" class="btn primary">Guardar usuario</button>
          <button id="btnCancelUser" class="btn">Cancelar</button>
        </div>
      </div>
    </section>

  </main>
</div>

<script type="module" src="app.js"></script>
</body>
</html>
