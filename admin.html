<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Estudiante ENARM | Administrador</title>

  <!-- CSS principal -->
  <link rel="stylesheet" href="style.css" />

  <!-- Fuente Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- Íconos (Font Awesome) -->
  <script src="https://kit.fontawesome.com/a2e0e9d6c3.js" crossorigin="anonymous"></script>
</head>
<body class="theme-dark">

  <!-- HEADER ADMIN -->
  <header class="admin-header">
    <button class="btn btn-outline" id="admin-btn-toggle-sidebar" title="Menú">
      <i class="fas fa-bars"></i>
    </button>

    <h1 class="admin-title">Panel Administrador</h1>

    <div class="admin-userbox">
      <span id="admin-user-email">admin@correo.com</span>
      <button class="btn btn-outline btn-sm" id="admin-btn-logout">
        Cerrar sesión
      </button>
    </div>
  </header>

  <main class="admin-main">

    <!-- SIDEBAR -->
    <aside class="sidebar" id="admin-sidebar">
      <div class="sidebar-section">
        <h2>Secciones</h2>
        <div id="admin-sections-list" class="sidebar-list"></div>
        <button class="btn btn-secondary btn-sm" id="admin-btn-add-section">
          + Nueva sección
        </button>
      </div>

      <hr class="sidebar-divider" />

      <div class="sidebar-section">
        <h2>Administración</h2>
        <button id="admin-btn-nav-exams" class="sidebar-btn">
          Exámenes
        </button>
        <button id="admin-btn-nav-bank" class="sidebar-btn">
          Banco preguntas
        </button>
        <button id="admin-btn-nav-mini" class="sidebar-btn">
          Mini-Exámenes
        </button>
        <button id="admin-btn-nav-users" class="sidebar-btn">
          Usuarios
        </button>
        <button id="admin-btn-nav-analytics" class="sidebar-btn">
          Análisis
        </button>
        <button id="admin-btn-nav-landing" class="sidebar-btn">
          Pantalla principal
        </button>
        <button id="admin-btn-nav-import-export" class="sidebar-btn">
          Import / Export
        </button>
      </div>
    </aside>

    <!-- CONTENEDOR PRINCIPAL -->
    <section class="admin-content">

      <!-- PANEL EXÁMENES -->
      <div id="admin-panel-exams" class="panel">

        <div class="panel-header">
          <div>
            <h2 id="admin-current-section-title">Sección: (sin seleccionar)</h2>
            <p class="panel-subtitle">
              Administra exámenes dentro de la sección seleccionada.
            </p>
          </div>

          <div class="flex-row">
            <button id="admin-btn-import-exams-json" class="btn btn-outline btn-sm">
              Importar exámenes (JSON)
            </button>
            <button id="admin-btn-add-exam" class="btn btn-primary">
              + Nuevo examen
            </button>
          </div>
        </div>

        <div id="admin-exams-list" class="cards-grid"></div>

        <!-- Vista detalle de un examen (hidden al inicio) -->
        <div id="admin-exam-detail" class="panel hidden">
          <div class="panel-header" style="align-items:flex-end;gap:12px;">
            <button id="admin-btn-back-to-exams" class="btn btn-outline">
              ← Volver a exámenes
            </button>

            <div style="flex:1;">
              <label class="field">
                <span>Nombre del examen</span>
                <input type="text" id="admin-exam-title-input" />
              </label>
            </div>

            <div class="flex-row" style="justify-content:flex-end;">
              <button id="admin-btn-import-exam" class="btn btn-outline btn-sm">
                Importar examen (JSON)
              </button>
              <button id="admin-btn-add-case" class="btn btn-secondary btn-sm">
                + Agregar caso clínico
              </button>
              <button id="admin-btn-save-exam" class="btn btn-primary btn-sm">
                Guardar examen
              </button>
            </div>
          </div>

      <div class="card" id="admin-auto-generator-card">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap;">
          <div style="flex:1;min-width:260px;">
            <h3 style="margin-bottom:4px;">Generador rápido (automático)</h3>
            <p class="panel-subtitle" style="margin:0;">
              Define temas y distribución por especialidad/subtipo. Se priorizan casos con menor <b>usageCount</b>.
            </p>
          </div>
          <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
            <label class="btn btn-sm btn-outline" style="cursor:pointer;">
              <input type="checkbox" id="admin-auto-append" style="display:none;">
              <span id="admin-auto-append-text">Reemplazar contenido</span>
            </label>
            <button class="btn btn-sm btn-secondary" id="admin-auto-btn-generate">Generar</button>
          </div>
        </div>

        <div class="create-user-grid" style="margin-top:12px;">
          <div class="field" style="grid-column:1 / -1;">
            <span>Temas (uno por línea o separados por coma)</span>
            <textarea id="admin-auto-topics" rows="3" placeholder="Ej: abdomen agudo, apendicitis, colecistitis, hernia incarcerada…"></textarea>
          </div>

          <div class="field">
            <span>Total de preguntas (referencia)</span>
            <input id="admin-auto-total-questions" type="number" min="1" step="1" value="280" />
          </div>

          <div class="field">
            <span>Modo de prioridad</span>
            <select id="admin-auto-priority-mode">
              <option value="usageAsc" selected>Priorizar no usados (0→1→2…)</option>
              <option value="random">Aleatorio</option>
            </select>
          </div>
        </div>

        <div style="margin-top:12px;">
          <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:flex-end;">
            <div class="field" style="min-width:260px;flex:1;">
              <span>Agregar especialidad</span>
              <select id="admin-auto-add-specialty-select"></select>
            </div>
            <button class="btn btn-sm btn-primary" id="admin-auto-add-specialty-btn">Agregar</button>
            <button class="btn btn-sm" id="admin-auto-autofill-btn">Autorrellenar 20/40/40</button>
            <button class="btn btn-sm" id="admin-auto-clear-plan-btn">Limpiar</button>
          </div>

          <div id="admin-auto-plan-rows" style="margin-top:10px;display:flex;flex-direction:column;gap:8px;"></div>
          <div id="admin-auto-plan-summary" style="margin-top:10px;font-size:12px;color:#9ca3af;"></div>
        </div>
      </div>

          <!-- ================= BUSCADOR PARA AGREGAR CASOS AL EXAMEN ================= -->
          <div class="card" style="margin-top:14px;">
            <h3 style="font-size:15px;margin-bottom:8px;">Agregar casos desde banco</h3>
            <p class="panel-subtitle" style="margin-top:-2px;">
              Escribe un tema y elige casos del banco para agregarlos al examen.
            </p>
            <input
              id="admin-bank-search-input"
              type="text"
              placeholder="Buscar por tema (ej. trauma, sepsis, embarazo ectópico)..."
              class="input"
            />
            <div id="admin-bank-search-results" style="margin-top:10px;"></div>
          </div>

          <!-- Contenedor de casos del examen -->
          <div id="admin-exam-cases" style="margin-top:14px;"></div>
        </div>
      </div>

      <!-- PANEL BANCO -->
      <div id="admin-panel-bank" class="panel hidden">
        <div class="panel-header">
          <div>
            <h2>Banco de preguntas</h2>
            <p class="panel-subtitle">
              Agrega, edita y gestiona el banco de casos (no asociados a un examen).
            </p>
          </div>
        </div>

        <div id="admin-bank-container" class="cards-grid"></div>
      </div>

      <!-- PANEL MINI-EXÁMENES -->
      <div id="admin-panel-mini" class="panel hidden">
        <div class="panel-header">
          <div>
            <h2>Mini-Exámenes</h2>
            <p class="panel-subtitle">
              Administra los casos usados para mini-exámenes (selección aleatoria / por tema).
            </p>
          </div>
        </div>

        <div class="card">
          <h3 style="font-size:15px;margin-bottom:8px;">Agregar casos desde banco</h3>
          <p class="panel-subtitle" style="margin-top:-2px;">
            Busca y agrega casos del banco para mini-exámenes.
          </p>

          <input
            id="admin-mini-bank-search-input"
            type="text"
            placeholder="Buscar por tema (ej. diabetes, asma, preeclampsia)..."
            class="input"
          />
          <div id="admin-mini-bank-search-results" style="margin-top:10px;"></div>
        </div>

        <div id="admin-mini-container" style="margin-top:14px;"></div>
      </div>

      <!-- PANEL USUARIOS -->
      <div id="admin-panel-users" class="panel hidden">
        <div class="panel-header">
          <div>
            <h2>Usuarios</h2>
            <p class="panel-subtitle">
              Crea usuarios, asigna rol, controla estatus y expiración.
            </p>
          </div>
        </div>

        <div class="card">
          <h3 style="font-size:15px;margin-bottom:10px;">Crear nuevo usuario</h3>

          <div class="create-user-grid">
            <label class="field">
              <span>Nombre</span>
              <input id="admin-new-user-name" type="text" placeholder="Nombre completo" />
            </label>

            <label class="field">
              <span>Email</span>
              <input id="admin-new-user-email" type="email" placeholder="correo@ejemplo.com" />
            </label>

            <label class="field">
              <span>Password</span>
              <input id="admin-new-user-password" type="text" placeholder="Contraseña" />
            </label>

            <label class="field">
              <span>Rol</span>
              <select id="admin-new-user-role">
                <option value="student">Estudiante</option>
                <option value="admin">Administrador</option>
              </select>
            </label>

            <label class="field">
              <span>Estatus</span>
              <select id="admin-new-user-status">
                <option value="active">Activo</option>
                <option value="inactive">Inactivo</option>
              </select>
            </label>

            <label class="field">
              <span>Expiración</span>
              <input id="admin-new-user-expiry" type="date" />
            </label>
          </div>

          <button class="btn btn-primary" id="admin-btn-create-user" style="margin-top:12px;">
            Crear usuario
          </button>
        </div>

        <div class="card" style="margin-top:14px;">
          <h3 style="font-size:15px;margin-bottom:10px;">Listado de usuarios</h3>
          <div id="admin-users-table"></div>
        </div>
      </div>

      <!-- PANEL ANALYTICS -->
      <div id="admin-panel-analytics" class="panel hidden">
        <div class="panel-header">
          <div>
            <h2>Análisis</h2>
            <p class="panel-subtitle">
              Métricas básicas de uso (logins, exámenes, mini-exámenes, etc.).
            </p>
          </div>
        </div>

        <div class="cards-grid">
          <div class="card">
            <h3 style="font-size:15px;margin-bottom:10px;">Resumen</h3>
            <div id="admin-analytics-summary"></div>
          </div>

          <div class="card">
            <h3 style="font-size:15px;margin-bottom:10px;">Usuarios</h3>
            <div id="admin-analytics-users"></div>
          </div>
        </div>
      </div>

      <!-- PANEL LANDING / SETTINGS -->
      <div id="admin-panel-landing" class="panel hidden">
        <div class="panel-header">
          <div>
            <h2>Pantalla principal</h2>
            <p class="panel-subtitle">
              Edita el texto y los precios que ve el usuario en la pantalla principal (index).
            </p>
          </div>
        </div>

        <div class="card">
          <h3 style="font-size:15px;margin-bottom:10px;">Texto principal</h3>
          <textarea id="admin-landing-text" rows="5" class="input" placeholder="Texto de bienvenida..."></textarea>

          <div class="create-user-grid" style="margin-top:12px;">
            <label class="field">
              <span>Etiqueta mensual</span>
              <input id="admin-monthly-label" type="text" placeholder="Mensual" />
            </label>

            <label class="field">
              <span>Precio mensual</span>
              <input id="admin-monthly-price" type="text" placeholder="$..." />
            </label>

            <label class="field">
              <span>Etiqueta ENARM</span>
              <input id="admin-enarm-label" type="text" placeholder="ENARM" />
            </label>

            <label class="field">
              <span>Precio ENARM</span>
              <input id="admin-enarm-price" type="text" placeholder="$..." />
            </label>

            <label class="field">
              <span>WhatsApp (tel)</span>
              <input id="admin-whatsapp-phone" type="text" placeholder="52..." />
            </label>
          </div>

          <h3 style="font-size:15px;margin:14px 0 10px;">Redes sociales</h3>

          <div class="create-user-grid">
            <label class="field">
              <span>Instagram</span>
              <input id="admin-instagram-link" type="text" placeholder="https://instagram.com/..." />
            </label>
            <label class="field">
              <span>WhatsApp link</span>
              <input id="admin-whatsapp-link" type="text" placeholder="https://wa.me/..." />
            </label>
            <label class="field">
              <span>TikTok</span>
              <input id="admin-tiktok-link" type="text" placeholder="https://tiktok.com/..." />
            </label>
            <label class="field">
              <span>Telegram</span>
              <input id="admin-telegram-link" type="text" placeholder="https://t.me/..." />
            </label>
          </div>

          <button class="btn btn-primary" id="admin-btn-save-landing" style="margin-top:14px;">
            Guardar cambios
          </button>
        </div>
      </div>

      <!-- MODAL GENÉRICO -->
      <div id="admin-modal-overlay" class="modal-overlay hidden">
        <div id="admin-modal" class="modal">
          <h3 id="admin-modal-title">Título modal</h3>
          <div id="admin-modal-body"></div>

          <div class="modal-actions">
            <button id="admin-modal-cancel" class="btn btn-outline">Cancelar</button>
            <button id="admin-modal-ok" class="btn btn-primary">Aceptar</button>
          </div>
        </div>
      </div>

    </section>
  </main>

  <!-- Firebase config -->
  <script type="module" src="firebase-config.js"></script>
  <!-- JS Admin -->
  <script type="module" src="admin.js"></script>
</body>
</html>
