<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Estudiante ENARM | Administrador</title>

  <!-- Fuente moderna -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Estilos compartidos -->
  <link rel="stylesheet" href="style.css" />

  <!-- Favicon (evita error 404 /favicon.ico) -->
  <link rel="icon" type="image/png" href="logo.png" />
</head>

<body>
  <section id="admin-view" class="view">

    <!-- HEADER -->
    <header class="header">
      <button id="admin-btn-toggle-sidebar" class="hamburger-btn">☰</button>
      <div class="header-right">
        <span id="admin-user-email"></span>
        <button id="admin-btn-logout" class="btn btn-secondary">Cerrar sesión</button>
      </div>
    </header>

    <!-- SIDEBAR ADMIN -->
    <aside id="admin-sidebar">
      <div class="sidebar-logo">
        <img src="logo.png" alt="Estudiante ENARM" class="sidebar-logo-img" />
        <h2 class="sidebar-title">Estudiante ENARM</h2>
      </div>

      <!-- Secciones dinámicas -->
      <ul id="admin-sections-list" class="sidebar-sections"></ul>

      <!-- Botón agregar sección -->
      <button id="admin-btn-add-section" class="sidebar-btn btn-outline">
        + Agregar sección
      </button>

      <!-- Navegación de paneles -->
      <div style="margin-top:12px;">
        <button id="admin-btn-nav-exams" class="sidebar-btn sidebar-btn--active">
          Secciones y exámenes
        </button>

        <!-- ✅ NUEVO: BANCO DE PREGUNTAS (solo admin) -->
        <button id="admin-btn-nav-bank" class="sidebar-btn">
          Banco de preguntas
        </button>

        <button id="admin-btn-nav-mini" class="sidebar-btn">
          Mini exámenes
        </button>
        <button id="admin-btn-nav-users" class="sidebar-btn">
          Usuarios
        </button>
        <button id="admin-btn-nav-analytics" class="sidebar-btn">
          Análisis
        </button>
        <button id="admin-btn-nav-landing" class="sidebar-btn">
          Pantalla principal
        </button>
      </div>
    </aside>

    <!-- CONTENIDO PRINCIPAL -->
    <main id="content">

      <!-- ================= PANEL: SECCIONES + EXÁMENES ================= -->
      <section id="admin-panel-exams" class="panel">
        <div class="panel-header">
          <div>
            <h2 id="admin-current-section-title">Selecciona una sección</h2>
            <p class="panel-subtitle">
              Administra los simulacros ENARM por sección.
            </p>
          </div>
          <div class="flex-row" style="justify-content:flex-end;">
            <button id="admin-btn-import-exams-json" class="btn btn-outline btn-sm">
              Importar exámenes (JSON)
            </button>
            <button id="admin-btn-add-exam" class="btn btn-primary btn-sm">
              + Agregar examen
            </button>
          </div>
        </div>

        <!-- Lista de exámenes por sección -->
        <div id="admin-exams-list" class="cards-list"></div>

        <!-- DETALLE DE EXAMEN (CASOS CLÍNICOS) -->
        <section id="admin-exam-detail" class="panel hidden">
          <div class="panel-header" style="align-items:flex-end;gap:12px;">
            <button id="admin-btn-back-to-exams" class="btn btn-outline">
              ← Volver a exámenes
            </button>

            <div style="flex:1;">
              <label class="field">
                <span>Nombre del examen</span>
                <input type="text" id="admin-exam-title-input" />
              </label>
            </div>

            <div class="flex-row" style="justify-content:flex-end;">
              <button id="admin-btn-import-exam" class="btn btn-outline btn-sm">
                Importar examen (JSON)
              </button>
              <button id="admin-btn-add-case" class="btn btn-secondary btn-sm">
                + Agregar caso clínico
              </button>
              <button id="admin-btn-save-exam" class="btn btn-primary btn-sm">
                Guardar examen
              </button>
            </div>
          </div>

          <!-- ================= NUEVO BLOQUE: BUSCADOR DE BANCO DE CASOS ================= -->
          <div class="card" style="margin-top:14px;">
            <h3 style="font-size:15px;margin-bottom:8px;">Agregar casos desde banco</h3>

            <label class="field">
              <span>Buscar por tema</span>
              <input
                type="text"
                id="admin-bank-search-input"
                placeholder="Ej. apendicitis aguda, preeclampsia, hemorragia posparto"
              />
            </label>

            <div id="admin-bank-search-results" class="cards-list" style="margin-top:10px;"></div>
          </div>
          <!-- ================= FIN BLOQUE NUEVO ================= -->

          <!-- Contenedor de casos clínicos + preguntas -->
          <div id="admin-exam-cases" class="cards-list"></div>
        </section>
      </section>

      <!-- ================= ✅ NUEVO PANEL: BANCO DE PREGUNTAS (questions) ================= -->
      <section id="admin-panel-bank" class="panel hidden">
        <div class="panel-header">
          <div>
            <h2>Banco de preguntas</h2>
            <p class="panel-subtitle">
              Edita casos del banco general (<code>questions</code>) y selecciona cuáles copiar a Mini exámenes (<code>miniQuestions</code>).
            </p>
          </div>
        </div>

        <!-- Filtros -->
        <div class="card">
          <div class="create-user-grid">
            <div class="field">
              <span>Buscar texto (caseText)</span>
              <input id="admin-bank-search" type="text" placeholder="Buscar dentro del caso clínico..." />
            </div>

            <div class="field">
              <span>Tema (topic)</span>
              <input id="admin-bank-topic" type="text" placeholder="Ej. Apendicitis / Preeclampsia..." />
            </div>

            <div class="field">
              <span>Especialidad</span>
              <input id="admin-bank-specialty" type="text" placeholder="Ej. medicina_interna / gine_obstetricia..." />
            </div>

            <div class="field">
              <span>ExamID</span>
              <input id="admin-bank-examid" type="text" placeholder="Filtrar por ID de examen..." />
            </div>
          </div>

          <div class="flex-row" style="justify-content:flex-end;gap:8px;margin-top:10px;">
            <button id="admin-bank-btn-clear" class="btn btn-outline btn-sm">Limpiar</button>
            <button id="admin-bank-btn-refresh" class="btn btn-outline btn-sm">Refrescar</button>
            <button id="admin-bank-btn-apply" class="btn btn-primary btn-sm">Aplicar filtros</button>
          </div>
        </div>

        <!-- Acciones selección -->
        <div class="card" style="display:flex;justify-content:space-between;align-items:center;gap:10px;">
          <div class="panel-subtitle" style="margin:0;">
            Selecciona casos (checkbox) para copiarlos a Mini exámenes.
          </div>
          <button id="admin-bank-btn-add-to-mini" class="btn btn-primary btn-sm" disabled>
            Agregar seleccionados a Mini exámenes
          </button>
        </div>

        <!-- Lista del banco -->
        <div id="admin-bank-list" class="cards-list"></div>

        <!-- Paginación -->
        <div style="display:flex;justify-content:flex-end;margin-top:10px;">
          <button id="admin-bank-btn-load-more" class="btn btn-outline btn-sm">
            Cargar más
          </button>
        </div>
      </section>

      <!-- ================= PANEL: MINI EXÁMENES (BANCO GLOBAL) ================= -->
      <section id="admin-panel-mini" class="panel hidden">
        <div class="panel-header">
          <div>
            <h2>Mini exámenes</h2>
            <p class="panel-subtitle">
              Banco global de casos clínicos para los mini exámenes del estudiante.
            </p>
          </div>

          <div class="flex-row" style="justify-content:flex-end;">
            <button id="admin-mini-btn-add-case" class="btn btn-secondary">
              + Agregar caso clínico
            </button>
            <button id="admin-mini-btn-save-all" class="btn btn-primary">
              Guardar banco
            </button>
          </div>
        </div>

        <!-- Aquí se pintan todos los casos clínicos de mini exámenes -->
        <div id="admin-mini-cases" class="cards-list"></div>
      </section>

      <!-- ================= PANEL: USUARIOS ================= -->
      <section id="admin-panel-users" class="panel hidden">
        <div class="panel-header">
          <div>
            <h2>Usuarios</h2>
            <p class="panel-subtitle">
              Crea, edita y administra los accesos a la plataforma.
            </p>
          </div>
        </div>

        <!-- Formulario nuevo usuario -->
        <div id="create-user-card">
          <h3>Nuevo usuario</h3>

          <div class="create-user-grid">
            <div class="field">
              <span>Nombre completo</span>
              <input type="text" id="admin-new-user-name" placeholder="Nombre del estudiante o admin" />
            </div>

            <div class="field">
              <span>Correo (ID del documento)</span>
              <input type="email" id="admin-new-user-email" placeholder="correo@ejemplo.com" />
            </div>

            <div class="field">
              <span>Contraseña (referencia)</span>
              <input type="text" id="admin-new-user-password" placeholder="Misma que en Authentication" />
            </div>

            <div class="field">
              <span>Rol</span>
              <select id="admin-new-user-role">
                <option value="usuario">Usuario</option>
                <option value="admin">Administrador</option>
              </select>
            </div>

            <div class="field">
              <span>Estado</span>
              <select id="admin-new-user-status">
                <option value="activo">Activo</option>
                <option value="inactivo">Inactivo</option>
              </select>
            </div>

            <div class="field">
              <span>Fecha de vencimiento</span>
              <input type="date" id="admin-new-user-expiry" />
            </div>
          </div>

          <div style="text-align:right;margin-top:10px;">
            <button id="admin-btn-create-user" class="btn btn-primary">
              Agregar usuario
            </button>
          </div>
        </div>

        <!-- Tabla de usuarios -->
        <div id="admin-users-table"></div>
      </section>

      <!-- ================= PANEL: ANÁLISIS ================= -->
      <section id="admin-panel-analytics" class="panel hidden">
        <div class="panel-header">
          <div>
            <h2>Análisis</h2>
            <p class="panel-subtitle">
              Estadísticas globales de secciones, exámenes y desempeño de los estudiantes.
            </p>
          </div>
        </div>

        <div id="admin-analytics-summary" class="cards-list"></div>
        <div id="admin-analytics-users" class="cards-list" style="margin-top:10px;"></div>
      </section>

      <!-- ================= PANEL: PANTALLA PRINCIPAL / LANDING ================= -->
      <section id="admin-panel-landing" class="panel hidden">
        <div class="panel-header">
          <div>
            <h2>Pantalla principal</h2>
            <p class="panel-subtitle">
              Configura el texto de bienvenida, precios y enlaces de la interfaz pública.
            </p>
          </div>
        </div>

        <!-- Bloque de texto principal -->
        <div class="card">
          <h3 style="font-size:16px;margin-bottom:8px;">Descripción de la plataforma</h3>
          <label class="field">
            <span>Texto que aparece debajo del panel de acceso</span>
            <textarea id="admin-landing-text" rows="5" placeholder="Descripción de la plataforma Estudiante ENARM"></textarea>
          </label>
        </div>

        <!-- Precios y WhatsApp -->
        <div class="card">
          <h3 style="font-size:16px;margin-bottom:8px;">Planes y WhatsApp</h3>

          <div class="create-user-grid">
            <div class="field">
              <span>Etiqueta plan mensual</span>
              <input type="text" id="admin-monthly-label" placeholder="Plan mensual" />
            </div>
            <div class="field">
              <span>Precio plan mensual (MXN)</span>
              <input type="number" id="admin-monthly-price" min="0" step="1" />
            </div>

            <div class="field">
              <span>Etiqueta plan ENARM 2026</span>
              <input type="text" id="admin-enarm-label" placeholder="Plan ENARM 2026" />
            </div>
            <div class="field">
              <span>Precio plan ENARM 2026 (MXN)</span>
              <input type="number" id="admin-enarm-price" min="0" step="1" />
            </div>

            <div class="field">
              <span>Número de WhatsApp</span>
              <input type="text" id="admin-whatsapp-phone" placeholder="+525515656316" />
            </div>
          </div>

          <div style="text-align:right;margin-top:10px;">
            <button id="admin-btn-save-landing" class="btn btn-primary">
              Guardar pantalla principal
            </button>
          </div>
        </div>

        <!-- Links de redes sociales -->
        <div class="card">
          <h3 style="font-size:16px;margin-bottom:8px;">Redes sociales</h3>

          <div class="create-user-grid">
            <div class="field">
              <span>Instagram</span>
              <input type="url" id="admin-instagram-link" placeholder="https://instagram.com/..." />
            </div>
            <div class="field">
              <span>WhatsApp (URL completa)</span>
              <input type="url" id="admin-whatsapp-link" placeholder="https://wa.me/..." />
            </div>
            <div class="field">
              <span>TikTok</span>
              <input type="url" id="admin-tiktok-link" placeholder="https://www.tiktok.com/..." />
            </div>
            <div class="field">
              <span>Telegram</span>
              <input type="url" id="admin-telegram-link" placeholder="https://t.me/..." />
            </div>
          </div>

          <div style="text-align:right;margin-top:10px;">
            <button id="admin-btn-save-social-links" class="btn btn-primary">
              Guardar redes sociales
            </button>
          </div>
        </div>
      </section>

    </main>

    <!-- MODAL GENÉRICO -->
    <div id="admin-modal-overlay" class="modal-overlay hidden">
      <div id="admin-modal" class="modal">
        <h3 id="admin-modal-title"></h3>
        <div id="admin-modal-body"></div>
        <div class="modal-actions">
          <button id="admin-modal-cancel" class="btn btn-outline">Cancelar</button>
          <button id="admin-modal-ok" class="btn btn-primary">Guardar</button>
        </div>
      </div>
    </div>

  </section>

  <!-- LÓGICA ADMIN -->
  <script type="module" src="admin.js"></script>
</body>
</html>
